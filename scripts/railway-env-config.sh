#!/bin/bash
# Script de configuration Railway pour mcp.coupaul.fr

echo "üöÇ Configuration Railway pour mcp.coupaul.fr"
echo "============================================"
echo ""

echo "üìã Variables d'environnement √† configurer dans Railway Dashboard:"
echo "================================================================="
echo ""
echo "1. PORT=8000"
echo "2. PYTHONUNBUFFERED=1"
echo "3. SUPABASE_URL=https://votre-projet.supabase.co"
echo "4. SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
echo "5. SUPABASE_SERVICE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9... (optionnel)"
echo ""

echo "üîß Instructions Railway Dashboard:"
echo "=================================="
echo ""
echo "1. üåê Allez sur Railway Dashboard:"
echo "   https://railway.app"
echo ""
echo "2. üìÅ S√©lectionnez votre projet MCP"
echo ""
echo "3. ‚öôÔ∏è Allez dans Settings > Variables"
echo ""
echo "4. ‚ûï Ajoutez chaque variable:"
echo "   - Cliquez sur 'Add Variable'"
echo "   - Nom: PORT, Valeur: 8000"
echo "   - Nom: PYTHONUNBUFFERED, Valeur: 1"
echo "   - Nom: SUPABASE_URL, Valeur: [votre URL Supabase]"
echo "   - Nom: SUPABASE_ANON_KEY, Valeur: [votre cl√© anonyme]"
echo ""
echo "5. üöÄ V√©rifiez la configuration du service:"
echo "   - Settings > Service"
echo "   - Start Command: laissez vide (utilise le CMD du Dockerfile)"
echo "   - Ou d√©finissez: python ultra_simple_server.py"
echo ""

echo "üîç V√©rification du Dockerfile:"
echo "=============================="
echo "Le Dockerfile devrait contenir:"
echo "FROM python:3.12-slim"
echo "WORKDIR /app"
echo "COPY ultra_simple_server.py ."
echo "EXPOSE 8000"
echo "CMD [\"python\", \"ultra_simple_server.py\"]"
echo ""

echo "üß™ Test apr√®s configuration:"
echo "============================"
echo "1. D√©ployez avec: railway up --detach"
echo "2. V√©rifiez les logs: railway logs"
echo "3. Testez l'endpoint: curl https://mcp.coupaul.fr/health"
echo ""

echo "‚ùå Probl√®me actuel:"
echo "==================="
echo "Railway essaie d'ex√©cuter 'src/supabase_server.py' au lieu de 'ultra_simple_server.py'"
echo "Cela indique que:"
echo "- Le Start Command Railway est mal configur√©"
echo "- Ou Railway utilise une ancienne configuration"
echo ""

echo "‚úÖ Solution:"
echo "============"
echo "1. Videz le Start Command dans Railway Dashboard"
echo "2. Ou d√©finissez: python ultra_simple_server.py"
echo "3. Red√©ployez le service"
echo ""

echo "üéØ Une fois configur√©, Railway devrait:"
echo "======================================"
echo "‚úÖ D√©marrer ultra_simple_server.py"
echo "‚úÖ Exposer le port 8000"
echo "‚úÖ R√©pondre √† /health"
echo "‚úÖ Passer le healthcheck Railway"
echo ""

echo "üìû Support Railway:"
echo "=================="
echo "Si le probl√®me persiste:"
echo "1. V√©rifiez les logs Railway Dashboard"
echo "2. Red√©marrez le service"
echo "3. Contactez le support Railway"
